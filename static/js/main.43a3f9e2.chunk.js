(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{15:function(t,e,a){},16:function(t,e,a){},20:function(t,e,a){"use strict";a.r(e);var s=a(0),i=a(1),n=a.n(i),o=a(7),r=a.n(o),c=(a(15),a(2)),y=a(3),l=a(5),d=a(4),u=(a(16),a(17),{HEAD:"H",BODY:"B",NOT_DEFINED:"_",HIT:"X",HITMISS:"Y"}),h=function(){for(var t=[],e=[],a=9;a>=0;a--){for(var s=[],i=0;i<10;i++)s.push({x:i,y:a,type:u.NOT_DEFINED});t.push(s)}var n,o=function(){r().forEach((function(t){t.type!==u.HITMISS&&(t.type=u.NOT_DEFINED)})),e.forEach((function(t){r().forEach((function(e){t.getBlocks().forEach((function(t){e.x===t.x&&e.y===t.y&&(t.type!==u.HEAD&&t.type!==u.BODY||e.type!==u.NOT_DEFINED||(e.type=t.type),t.type===u.HITMISS&&e.type===u.NOT_DEFINED&&(e.type=u.HITMISS),t.type===u.HIT&&e.type===u.NOT_DEFINED&&(e.type=u.HIT),t.type===u.HIT&&e.type===u.HITMISS&&(e.type=u.HIT))}))}))}))},r=function(){var e=[];return t.forEach((function(t){t.forEach((function(t){e.push(t)}))})),[].concat(e)};return{boardSize:10,getBlocks:r,addPlane:function(t){var a=!0;return t.getBlocks().forEach((function(t){(t.x<0||t.x>9||t.y<0||t.y>9)&&(t.type!==u.HEAD&&t.type!==u.BODY||(a=!1))})),r().forEach((function(e){t.getBlocks().forEach((function(t){e.x===t.x&&e.y===t.y&&(e.type!==u.HEAD&&e.type!==u.BODY||t.type!==u.HEAD&&t.type!==u.BODY||(a=!1))}))})),a&&(e.push(t),o()),a},getPlanes:function(){return e},rotate:function(a){a.rotate(),e.forEach((function(t){t.getBlocks().forEach((function(s){e.forEach((function(e){t!==e&&e.getBlocks().forEach((function(t){s.x===t.x&&s.y===t.y&&(s.type===u.BODY&&t.type===u.BODY||s.type===u.HEAD&&t.type===u.HEAD||s.type===u.HEAD&&t.type===u.BODY||s.type===u.BODY&&t.type===u.HEAD)&&(a.rotate(),a.rotate(),a.rotate())}))}))}))})),a.getBlocks().forEach((function(e){!(e.x<0||e.x>t.length-1||e.y<0||e.y>t.length-1)||e.type!==u.BODY&&e.type!==u.HEAD||(a.rotate(),a.rotate(),a.rotate())})),o()},hit:function(t){var a=t.x,s=t.y;r().forEach((function(t){t.x===parseInt(a)&&t.y===parseInt(s)&&(t.type=u.HITMISS)})),e.forEach((function(t){t.hit({x:a,y:s})})),o()},moveSelectedPlane:function(a,s){var i=a.x,c=a.y,y=s.x,l=s.y,d=y-i,h=l-c,p=!0;void 0!==n&&(n.getBlocks().forEach((function(e){!(e.x+d<0||e.x+d>t.length-1||e.y+h<0||e.y+h>t.length-1)||e.type!==u.BODY&&e.type!==u.HEAD||(p=!1)})),e.forEach((function(t){t!==n&&t.getBlocks().forEach((function(t){n.getBlocks().forEach((function(e){t.type!==u.HEAD&&t.type!==u.BODY||e.type!==u.HEAD&&e.type!==u.BODY||t.x===e.x+d&&t.y===e.y+h&&(p=!1)}))}))})),p&&(r().forEach((function(t){n.getBlocks().forEach((function(e){t.x===e.x&&t.y===e.y&&(t.type=u.NOT_DEFINED)}))})),n.move(d,h),o()))},moveOrigin:{x:0,y:0},selectPlane:function(t){var a,s=t.x,i=t.y;e.forEach((function(t){t.getBlocks().forEach((function(e){e.x===parseInt(s)&&e.y===parseInt(i)&&(a=t)}))})),a!==n&&void 0!==a&&(n=a)},getSelectedPlane:function(){return n}}},p=function(t){var e={x:t.x,y:t.y},a=!1,s=[[{x:e.x-1,y:e.y,type:u.NOT_DEFINED},{x:e.x,y:e.y,type:u.HEAD},{x:e.x+1,y:e.y,type:u.NOT_DEFINED},{x:e.x+2,y:e.y,type:u.NOT_DEFINED}],[{x:e.x-1,y:e.y-1,type:u.BODY},{x:e.x,y:e.y-1,type:u.BODY},{x:e.x+1,y:e.y-1,type:u.BODY},{x:e.x+2,y:e.y-1,type:u.NOT_DEFINED}],[{x:e.x-1,y:e.y-2,type:u.NOT_DEFINED},{x:e.x,y:e.y-2,type:u.BODY},{x:e.x+1,y:e.y-2,type:u.NOT_DEFINED},{x:e.x+2,y:e.y-2,type:u.NOT_DEFINED}],[{x:e.x-1,y:e.y-3,type:u.BODY},{x:e.x,y:e.y-3,type:u.BODY},{x:e.x+1,y:e.y-3,type:u.BODY},{x:e.x+2,y:e.y-3,type:u.NOT_DEFINED}]],i=function(){var t=[];return s.forEach((function(e){e.forEach((function(e){t.push(e)}))})),[].concat(t)};return{getHead:function(){return e},getBlocks:i,hit:function(t){var s=t.x,n=t.y,o=!1;parseInt(s)===e.x&&parseInt(n)===e.y&&(o=!0),i().forEach((function(t){t.x===parseInt(s)&&t.y===parseInt(n)&&(t.type!==u.BODY&&t.type!==u.HEAD||(t.type=u.HIT)),o&&t.type===u.BODY&&(t.type=u.HIT)})),a=!0,i().forEach((function(t){t.type!==u.HEAD&&t.type!==u.BODY||(a=!1)}))},rotate:function(){for(var t=[[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}]],a=0;a<s.length;a++)for(var n=0;n<s.length;n++)t[a][n].x=s[a][n].x,t[a][n].y=s[a][n].y,t[a][n].type=s[s.length-n-1][a].type;s.splice.apply(s,[0,s.length].concat(t)),i().forEach((function(t){t.type===u.HEAD&&(e={x:t.x,y:t.y})}))},getDead:function(){return a},blockType:u,move:function(t,a){for(var n=[[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}],[{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0},{x:0,y:0,type:0}]],o=0;o<s.length;o++)for(var r=0;r<s.length;r++)n[o][r].x=s[o][r].x+parseInt(t),n[o][r].y=s[o][r].y+parseInt(a),n[o][r].type=s[o][r].type;s.splice.apply(s,[0,s.length].concat(n)),i().forEach((function(t){t.type===u.HEAD&&(e={x:t.x,y:t.y})}))}}};var g=function(t){var e="",a=t.block;switch(t.block.type){case"H":e="btn-primary";break;case"B":e="btn-secondary";break;case"_":e="btn-light";break;case"X":e="btn-danger";break;case"Y":e="btn-warning"}return!1===t.visible&&t.block.type!==u.HIT&&t.block.type!==u.HITMISS&&(e="btn-light"),Object(s.jsx)("div",{className:"".concat(e," ").concat(a.x," ").concat(a.y),style:{border:"1px solid darkgrey",margin:"0px",width:"100%",height:"100%"},"data-x":a.x,"data-y":a.y})},x=a(8),b=a.n(x),m={selecting:1,moving:2,movingout:3,movingin:4,dropped:5,hitting:6,locked:7,hideen:8,touchSelecting:9,touchDropped:10},f=function(t){Object(l.a)(a,t);var e=Object(d.a)(a);function a(t){var s;return Object(c.a)(this,a),(s=e.call(this,t)).computeAndDeclareWinner=function(t){var e=!1;s.gameBoard.getPlanes().forEach((function(t){!1===t.getDead()&&(e=!0)})),e||s.pubsub.publish("gameEvent","".concat(t,"win"))},s.createRandomPlanes=function(){for(var t=[],e=0;e<3;){t[e]=p({x:Math.floor(Math.random()*Math.sqrt(s.gameBoard.getBlocks().length)),y:Math.floor(Math.random()*Math.sqrt(s.gameBoard.getBlocks().length))});for(var a=!1;!1===a;){t[e]=null,t[e]=p({x:Math.floor(Math.random()*Math.sqrt(s.gameBoard.getBlocks().length)),y:Math.floor(Math.random()*Math.sqrt(s.gameBoard.getBlocks().length))}),a=s.addPlane(t[e]);for(var i=0;i<2*Math.random();i++)s.gameBoard.rotate(t[e])}e++}},s.addPlane=function(t){return s.gameBoard.addPlane(t)},s.gameBoard=h(),s.state={status:t.gameStatus,visible:t.visible,boardType:t.boardType,gameBoardGrid:s.gameBoard.getBlocks()},s.clicks=0,s.clickdelay=400,s.mounted=!1,s.lastmove=null,s.createRandomPlanes(),s.pubsub=t.pubsub,"ai"===s.state.boardType&&(s.pubsub.unsubscribe("player"),s.pubsub.subscribe("player",(function(t){"playerdidhit"===t&&(s.setState({status:m.locked}),s.pubsub.publish("ai","aitriggerhit")),"aididhit"===t&&s.setState({status:m.hitting})}))),"player"===s.state.boardType&&(s.pubsub.unsubscribe("ai"),s.pubsub.subscribe("ai",(function(t){if("aitriggerhit"===t){var e=[];s.gameBoard.getBlocks().forEach((function(t){t.type!==u.HIT&&t.type!==u.HITMISS&&e.push(t)}));var a=Math.floor(Math.random()*e.length);s.alreadyHit=!1,s.gameBoard.getBlocks().forEach((function(t){t.x===e[a].x&&t.y===e[a].y&&(s.gameBoard.hit({x:t.x,y:t.y}),s.pubsub.publish("player","aididhit"))})),s.computeAndDeclareWinner("ai"),s.mounted&&s.setState({gameBoardGrid:s.gameBoard.getBlocks()})}}))),s}return Object(y.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0}},{key:"componentDidUpdate",value:function(t){t.gameStatus!==this.props.gameStatus&&this.setState({status:this.props.gameStatus})}},{key:"mouseClick",value:function(t){this.state.status!==m.locked&&(this.gameBoard.hit({x:t.target.dataset.x,y:t.target.dataset.y}),this.setState({gameBoardGrid:this.gameBoard.getBlocks()}),"ai"===this.state.boardType&&(this.pubsub.publish("player","playerdidhit"),this.computeAndDeclareWinner("player")))}},{key:"mouseDown",value:function(t){if(!this.is_touch_device()&&this.state.status!==m.locked){if(this.state.status===m.selecting||this.state.status===m.dropped){if(this.clicks++,setTimeout(function(){this.clicks=0}.bind(this),this.clickdelay),2===this.clicks)return this.gameBoard.selectPlane({x:t.target.dataset.x,y:t.target.dataset.y}),this.gameBoard.rotate(this.gameBoard.getSelectedPlane()),this.setState({gameBoardGrid:this.gameBoard.getBlocks()}),void(this.clicks=0);this.setState({status:m.moving}),this.gameBoard.selectPlane({x:t.target.dataset.x,y:t.target.dataset.y}),this.gameBoard.moveOrigin={x:t.target.dataset.x,y:t.target.dataset.y}}this.state.status===m.hitting&&this.mouseClick(t)}}},{key:"mouseLeave",value:function(t){this.is_touch_device()||this.state.status!==m.locked&&(this.state.status!==m.moving&&this.state.status!==m.movingin||(null!==t.target.dataset.x&&null!==t.target.dataset.y&&(this.setState({status:m.movingout}),this.gameBoard.moveOrigin={x:t.target.dataset.x,y:t.target.dataset.y}),this.forceUpdate()))}},{key:"mouseEnter",value:function(t){if(!this.is_touch_device()&&this.state.status!==m.locked&&this.state.status===m.movingout){if(null!=t.target.dataset.x&&null!=t.target.dataset.y){var e=t.target.dataset.x,a=t.target.dataset.y;this.gameBoard.moveSelectedPlane(this.gameBoard.moveOrigin,{x:e,y:a})}this.setState({gameBoardGrid:this.gameBoard.getBlocks()}),this.setState({status:m.movingin}),this.forceUpdate()}}},{key:"mouseUp",value:function(t){this.is_touch_device()||this.state.status!==m.locked&&this.state.status!==m.hitting&&this.setState({status:m.dropped})}},{key:"touchStart",value:function(t){if(console.log(this.state.status),this.lastmove=t,this.state.status!==m.locked){if(this.state.status===m.selecting&&void 0!==t.target.dataset)if(this.clicks++,setTimeout(function(){this.clicks=0}.bind(this),this.clickdelay),2===this.clicks)this.gameBoard.selectPlane({x:t.target.dataset.x,y:t.target.dataset.y}),void 0!==this.gameBoard.getSelectedPlane()&&this.gameBoard.rotate(this.gameBoard.getSelectedPlane()),this.setState({gameBoardGrid:this.gameBoard.getBlocks()}),this.clicks=0;else{var e=document.elementFromPoint(t.changedTouches[0].pageX,t.changedTouches[0].pageY);this.gameBoard.selectPlane({x:t.target.dataset.x,y:t.target.dataset.y}),this.gameBoard.moveOrigin={x:e.dataset.x,y:e.dataset.y}}this.state.status===m.hitting&&this.mouseClick(t)}}},{key:"touchMove",value:function(t){this.lastmove=t}},{key:"touchEnd",value:function(t){if(this.state.status===m.selecting){var e=document.elementFromPoint(this.lastmove.changedTouches[0].pageX,this.lastmove.changedTouches[0].pageY);console.log(e.dataset.x+" "+e.dataset.y),void 0!==t.target.dataset.x&&e.dataset.x>=0&&e.dataset.x<10&&e.dataset.y>=0&&e.dataset.y<10&&this.gameBoard.moveSelectedPlane(this.gameBoard.moveOrigin,{x:e.dataset.x,y:e.dataset.y}),this.setState({gameBoardGrid:this.gameBoard.getBlocks()}),this.forceUpdate()}}},{key:"is_touch_device",value:function(){return"ontouchstart"in window}},{key:"render",value:function(){var t=this;return Object(s.jsx)("div",{className:"container",children:Object(s.jsx)("div",{onTouchMove:this.touchMove.bind(this),className:"card",style:{width:"240px",height:"240px"},children:Object(s.jsx)("div",{className:"card-body",style:{position:"relative",display:"grid",gridTemplateRows:"repeat(10, 20px)",gridTemplateColumns:"repeat(10, 20px)"},children:this.state.gameBoardGrid.map((function(e){return Object(s.jsx)("div",{className:"box",onMouseDown:t.mouseDown.bind(t),onMouseLeave:t.mouseLeave.bind(t),onMouseOver:t.mouseEnter.bind(t),onMouseUp:t.mouseUp.bind(t),onTouchStart:t.touchStart.bind(t),onTouchEnd:t.touchEnd.bind(t),children:Object(s.jsx)(g,{block:e,visible:t.state.visible})},b()())}))})})})}}]),a}(i.Component),v=a(9),B=a.n(v),E=function(t){Object(l.a)(a,t);var e=Object(d.a)(a);function a(){var t;return Object(c.a)(this,a),(t=e.call(this)).onPlayClick=function(){console.log("hitting status"),t.board2Status=m.hitting,t.board1Status=m.locked,t.forceUpdate()},t.onPlayAgain=function(){window.location.reload(!1)},console.log("startup"),t.board1Status=m.selecting,t.board2Status=m.locked,t.winner="",t.pubsub=new B.a,t.pubsub.subscribe("gameEvent",(function(e){"playerwin"===e&&(t.winner="player",t.board1Status=m.locked,t.board2Status=m.locked,t.forceUpdate()),"aiwin"===e&&(t.winner="ai",t.board1Status=m.locked,t.board2Status=m.locked,t.forceUpdate())})),t.pubsub.publish("gameEvent","start"),t}return Object(y.a)(a,[{key:"render",value:function(){return Object(s.jsx)("div",{children:Object(s.jsx)("div",{className:"card",style:{width:"100%"},children:Object(s.jsxs)("div",{className:"card-body",children:[this.board1Status===m.selecting&&Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"alert alert-primary",role:"alert",style:{width:"100%",textAlign:"center"},children:"Place the planes!"}),Object(s.jsx)("div",{className:"alert alert-info",role:"alert",style:{width:"100%",textAlign:"center"},children:"Drag them around, double click to rotate"})]}),this.board1Status===m.selecting&&Object(s.jsx)("div",{children:Object(s.jsx)("button",{type:"button",className:"btn btn-dark",onClick:this.onPlayClick.bind(this),style:{width:"50%",marginLeft:"25%",marginRight:"25%"},children:"Play!"})}),"player"===this.winner&&Object(s.jsx)("div",{className:"alert alert-success",role:"alert",style:{width:"50%",marginLeft:"25%",marginRight:"25%",textAlign:"center"},children:"YOU WON!"}),"ai"===this.winner&&Object(s.jsx)("div",{className:"alert alert-danger",role:"alert",style:{width:"50%",marginLeft:"25%",marginRight:"25%",textAlign:"center"},children:"YOU LOST!"}),("ai"===this.winner||"player"===this.winner)&&Object(s.jsx)("button",{type:"button",className:"btn btn-dark",onClick:this.onPlayAgain.bind(this),style:{width:"50%",marginLeft:"25%",marginRight:"25%"},children:"Play again!"}),Object(s.jsx)("div",{className:"container",children:Object(s.jsxs)("div",{className:"row justify-content-center",children:[Object(s.jsx)("div",{className:"col-auto mx-auto",style:{marginTop:"10px"},children:Object(s.jsx)(f,{gameStatus:this.board1Status,visible:!0,boardType:"player",pubsub:this.pubsub})}),Object(s.jsx)("div",{className:"col-auto mx-auto",style:{marginTop:"10px"},children:this.board1Status!==m.selecting&&Object(s.jsx)(f,{gameStatus:this.board2Status,visible:!1,boardType:"ai",pubsub:this.pubsub})})]})})]})})})}}]),a}(i.Component);r.a.render(Object(s.jsx)(n.a.StrictMode,{children:Object(s.jsx)(E,{})}),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.43a3f9e2.chunk.js.map